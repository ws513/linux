#!/bin/bash

# ì§€ì¶œ ë°ì´í„° íŒŒì¼ì´ ì¡´ìž¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
DATA_FILES=(*_data.csv)
if [ ! -f "${DATA_FILES[0]}" ]; then
    echo "âŒ ë¶„ì„í•  ë°ì´í„° íŒŒì¼ (*_data.csv)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    echo "íŒ€ì›ì—ê²Œ ê¸°ëŠ¥ 1 (feature/add) êµ¬í˜„ ë° ë°ì´í„° ì¶”ê°€ë¥¼ ìš”ì²­í•˜ì„¸ìš”."
    exit 1
fi

echo "--- ì „ì²´ ì§€ì¶œ ì¡°íšŒ ---"

# ë‚ ì§œ ë²”ìœ„ ìž…ë ¥ ë°›ê¸° (ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥)
read -p "ì‹œìž‘ ë‚ ì§œ (YYYY-MM-DD, ì „ì²´ ì¡°íšŒ ì‹œ Enter): " START_DATE
read -p "ì¢…ë£Œ ë‚ ì§œ (YYYY-MM-DD, ì „ì²´ ì¡°íšŒ ì‹œ Enter): " END_DATE

# awkë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  íŒŒì¼ì—ì„œ ê¸ˆì•¡ ì—´(3ì—´)ì„ í•©ì‚°í•˜ê³  ë‚ ì§œ í•„í„°ë§
TOTAL=$(awk -F, -v start="$START_DATE" -v end="$END_DATE" '
    BEGIN {sum = 0}
    FILENAME ~ /data.csv$/ {
        DATE=$1; AMOUNT=$3
        
        # ë‚ ì§œ í•„í„°ë§ ë¡œì§: ì‹œìž‘ì¼ê³¼ ì¢…ë£Œì¼ ì‚¬ì´ì— ìžˆëŠ”ì§€ í™•ì¸
        if ((start == "" || DATE >= start) && (end == "" || DATE <= end)) {
            # ê¸ˆì•¡ í•©ì‚° (ìˆ«ìžì—¬ì•¼ í•¨)
            if (AMOUNT ~ /^[0-9]+$/) {
                sum += AMOUNT
            }
        }
    }
    END {
        printf "%.0f", sum
    }
' "${DATA_FILES[@]}")

# ê²°ê³¼ ì¶œë ¥
echo "ðŸ’° ì„ íƒ ê¸°ê°„ ì´ ì§€ì¶œ: ${TOTAL}ì›"
